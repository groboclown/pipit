'use strict';

const awsCommon = require('../../lib/aws-common');
const lambdas = require('../../lib/lambdas');
const textParse = require('../../lib/test-parse');

/**
 * AWS Lambda version 2015-03-31
 *
 * --- TODO REMOVE WHEN IMPLEMENTED ---
 * AUTOGENERATED BY build-api.py
 */

// Setup input and output to use AWS protocol rest-json
require('../../lib/aws-common/shape_http')('rest-json', module.exports, null);



// ========================================================================
// Implemented Functions

// -----------------------------------
module.exports.CreateFunction = awsCommon.as(
  '/2015-03-31/functions',
  function CreateFunction(aws) {
    var vpcConfig = aws.params.VpcConfig;
    var functionName = aws.params.FunctionName;
    var memorySize = aws.params.MemorySize;
    var description = aws.params.Description;
    var timeout = aws.params.Timeout;
    var code = aws.params.Code;
    var runtime = aws.params.Runtime;
    var role = aws.params.Role;
    var publish = aws.params.Publish;
    var handler = aws.params.Handler;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!runtime) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Runtime'];
    }
    if (!role) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Role'];
    }
    if (!handler) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Handler'];
    }
    if (!code) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Code'];
    }

    var next = null;
    if (!!code.ZipFile) {
      // An uploaded zip file.
      // ZipFile is a base-64 encoded binary.
      next = lambdas.saveBase64File(code.ZipFile)
        .then(function(filePath) {
          return 'file:' + filePath;
        });
    } else if (!!code.S3Bucket && !!code.S3Key) {
      // TODO extract from the s3 API.
      return [500, 'Server', 'NotImplementedException', 'S3 bucket storage not supported yet.'];
    } else {
      return [400, 'Sender', 'ResourceNotFoundException', 'Could not find lambda function for code ' + JSON.stringify(code)];
    }

    // Adding the lambda returns the
    return next
    .then(function(zipFilename) {
      return lambdas.addLambda({
        functionName: functionName,
        description: description,
        role: role,
        codeFileLocation: zipFilename,
        memorySize: memorySize,
        publish: publish,
        runtime: runtime,
        handler: handler,
        timeout: timeout,
        awsRequest: aws,
        enabled: true,
        vpcConfig: vpcConfig,
      });
    })
    .then(function(lambda) {
      return [201, lambda.describe()];
    })
    .catch(function(err) {
      if (Array.isArray(err)) {
        // Handle right
        return [400, 'Sender', err[0], err[1]];
      }
      // Propigate to the surface
      throw err;
    });
  });


// -----------------------------------
module.exports.DeleteFunction = awsCommon.as(
  'DELETE',
  '/2015-03-31/functions/:FunctionName',
  function DeleteFunction(aws) {
    // TODO the reqParams isn't loaded right.  It's instead loaded into
    // restParams.
    var functionName = aws.restParams.FunctionName;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }

    var result = lambdas.removeLambda(functionName, qualifier);
    if (!result) {
      var ret = {};
      return [204, ret];
    }
    return [404, 'Sender', 'ResourceNotFoundException', result];
  });


// ========================================================================
// To-Be Implemented Functions




// -----------------------------------
module.exports.ListEventSourceMappings = awsCommon.as(
  'GET',
  '/2015-03-31/event-source-mappings/',
  function ListEventSourceMappings(aws) {
    var maxItems = aws.params.MaxItems /* Type integer */;
    var eventSourceArn = aws.params.EventSourceArn;
    var marker = aws.params.Marker;
    var functionName = aws.params.FunctionName;


    // TODO implement code

    var ret = {
      EventSourceMappings: [ /*Sm*/{
        LastModified: awsCommon.timestamp(),
        FunctionArn: '',
        BatchSize: 0,
        State: '',
        UUID: '',
        EventSourceArn: '',
        StateTransitionReason: '',
        LastProcessingResult: '',
      }, /* ...*/ ],
      NextMarker: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.DeleteEventSourceMapping = awsCommon.as(
  'DELETE',
  '/2015-03-31/event-source-mappings/:UUID',
  function DeleteEventSourceMapping(aws) {
    var uUID = aws.reqParams.UUID;
    if (!uUID) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter UUID'];
    }


    // TODO implement code

    var ret = /*Sm*/{
      LastModified: awsCommon.timestamp(),
      FunctionArn: '',
      BatchSize: 0,
      State: '',
      UUID: '',
      EventSourceArn: '',
      StateTransitionReason: '',
      LastProcessingResult: '',
    };
    return [202, ret];
  });
// -----------------------------------
module.exports.CreateAlias = awsCommon.as(
  '/2015-03-31/functions/:FunctionName/aliases',
  function CreateAlias(aws) {
    var name = aws.params.Name;
    var functionName = aws.reqParams.FunctionName;
    var functionVersion = aws.params.FunctionVersion;
    var description = aws.params.Description;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!name) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Name'];
    }
    if (!functionVersion) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionVersion'];
    }


    // TODO implement code

    var ret = /*Sg*/{
      Name: '',
      AliasArn: '',
      FunctionVersion: '',
      Description: '',
    };
    return [201, ret];
  });
// -----------------------------------
module.exports.PublishVersion = awsCommon.as(
  '/2015-03-31/functions/:FunctionName/versions',
  function PublishVersion(aws) {
    var functionName = aws.reqParams.FunctionName;
    var codeSha256 = aws.params.CodeSha256;
    var description = aws.params.Description;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = /*S15*/{
      VpcConfig: {
        SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
        VpcId: '',
        SubnetIds: /*S11*/[ '', /* ...*/ ],
      },
      CodeSize: 0 /*Long*/,
      Description: '',
      Timeout: 0,
      MemorySize: 0,
      Handler: '',
      LastModified: '',
      FunctionName: '',
      FunctionArn: '',
      CodeSha256: '',
      Version: '',
      Runtime: '',
      Role: '',
    };
    return [201, ret];
  });
// -----------------------------------
module.exports.GetFunction = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName',
  function GetFunction(aws) {
    var functionName = aws.reqParams.FunctionName;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = {
      Code: {
        RepositoryType: '',
        Location: '',
      },
      Configuration: /*S15*/{
        VpcConfig: {
          SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
          VpcId: '',
          SubnetIds: /*S11*/[ '', /* ...*/ ],
        },
        CodeSize: 0 /*Long*/,
        Description: '',
        Timeout: 0,
        MemorySize: 0,
        Handler: '',
        LastModified: '',
        FunctionName: '',
        FunctionArn: '',
        CodeSha256: '',
        Version: '',
        Runtime: '',
        Role: '',
      },
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.UpdateFunctionCode = awsCommon.as(
  'PUT',
  '/2015-03-31/functions/:FunctionName/code',
  function UpdateFunctionCode(aws) {
    var s3Bucket = aws.params.S3Bucket;
    var functionName = aws.reqParams.FunctionName;
    var s3Key = aws.params.S3Key;
    var s3ObjectVersion = aws.params.S3ObjectVersion;
    var zipFile = aws.params.ZipFile /* Type blob */;
    var publish = aws.params.Publish /* Type boolean */;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = /*S15*/{
      VpcConfig: {
        SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
        VpcId: '',
        SubnetIds: /*S11*/[ '', /* ...*/ ],
      },
      CodeSize: 0 /*Long*/,
      Description: '',
      Timeout: 0,
      MemorySize: 0,
      Handler: '',
      LastModified: '',
      FunctionName: '',
      FunctionArn: '',
      CodeSha256: '',
      Version: '',
      Runtime: '',
      Role: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.UpdateAlias = awsCommon.as(
  'PUT',
  '/2015-03-31/functions/:FunctionName/aliases/:Name',
  function UpdateAlias(aws) {
    var name = aws.reqParams.Name;
    var functionName = aws.reqParams.FunctionName;
    var functionVersion = aws.params.FunctionVersion;
    var description = aws.params.Description;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!name) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Name'];
    }


    // TODO implement code

    var ret = /*Sg*/{
      Name: '',
      AliasArn: '',
      FunctionVersion: '',
      Description: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.GetPolicy = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName/policy',
  function GetPolicy(aws) {
    var functionName = aws.reqParams.FunctionName;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = {
      Policy: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.ListVersionsByFunction = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName/versions',
  function ListVersionsByFunction(aws) {
    var maxItems = aws.params.MaxItems /* Type integer */;
    var functionName = aws.reqParams.FunctionName;
    var marker = aws.params.Marker;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = {
      Versions: /*S23*/[ /*S15*/{
        VpcConfig: {
          SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
          VpcId: '',
          SubnetIds: /*S11*/[ '', /* ...*/ ],
        },
        CodeSize: 0 /*Long*/,
        Description: '',
        Timeout: 0,
        MemorySize: 0,
        Handler: '',
        LastModified: '',
        FunctionName: '',
        FunctionArn: '',
        CodeSha256: '',
        Version: '',
        Runtime: '',
        Role: '',
      }, /* ...*/ ],
      NextMarker: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.GetEventSourceMapping = awsCommon.as(
  'GET',
  '/2015-03-31/event-source-mappings/:UUID',
  function GetEventSourceMapping(aws) {
    var uUID = aws.reqParams.UUID;
    if (!uUID) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter UUID'];
    }


    // TODO implement code

    var ret = /*Sm*/{
      LastModified: awsCommon.timestamp(),
      FunctionArn: '',
      BatchSize: 0,
      State: '',
      UUID: '',
      EventSourceArn: '',
      StateTransitionReason: '',
      LastProcessingResult: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.ListFunctions = awsCommon.as(
  'GET',
  '/2015-03-31/functions/',
  function ListFunctions(aws) {
    var maxItems = aws.params.MaxItems /* Type integer */;
    var marker = aws.params.Marker;


    // TODO implement code

    var ret = {
      Functions: /*S23*/[ /*S15*/{
        VpcConfig: {
          SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
          VpcId: '',
          SubnetIds: /*S11*/[ '', /* ...*/ ],
        },
        CodeSize: 0 /*Long*/,
        Description: '',
        Timeout: 0,
        MemorySize: 0,
        Handler: '',
        LastModified: '',
        FunctionName: '',
        FunctionArn: '',
        CodeSha256: '',
        Version: '',
        Runtime: '',
        Role: '',
      }, /* ...*/ ],
      NextMarker: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.CreateEventSourceMapping = awsCommon.as(
  '/2015-03-31/event-source-mappings/',
  function CreateEventSourceMapping(aws) {
    var enabled = aws.params.Enabled /* Type boolean */;
    var eventSourceArn = aws.params.EventSourceArn;
    var startingPosition = aws.params.StartingPosition;
    var functionName = aws.params.FunctionName;
    var batchSize = aws.params.BatchSize /* Type integer */;
    if (!eventSourceArn) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter EventSourceArn'];
    }
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!startingPosition) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter StartingPosition'];
    }


    // TODO implement code

    var ret = /*Sm*/{
      LastModified: awsCommon.timestamp(),
      FunctionArn: '',
      BatchSize: 0,
      State: '',
      UUID: '',
      EventSourceArn: '',
      StateTransitionReason: '',
      LastProcessingResult: '',
    };
    return [202, ret];
  });
// -----------------------------------
module.exports.UpdateEventSourceMapping = awsCommon.as(
  'PUT',
  '/2015-03-31/event-source-mappings/:UUID',
  function UpdateEventSourceMapping(aws) {
    var enabled = aws.params.Enabled /* Type boolean */;
    var functionName = aws.params.FunctionName;
    var uUID = aws.reqParams.UUID;
    var batchSize = aws.params.BatchSize /* Type integer */;
    if (!uUID) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter UUID'];
    }


    // TODO implement code

    var ret = /*Sm*/{
      LastModified: awsCommon.timestamp(),
      FunctionArn: '',
      BatchSize: 0,
      State: '',
      UUID: '',
      EventSourceArn: '',
      StateTransitionReason: '',
      LastProcessingResult: '',
    };
    return [202, ret];
  });
// -----------------------------------
module.exports.ListAliases = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName/aliases',
  function ListAliases(aws) {
    var maxItems = aws.params.MaxItems /* Type integer */;
    var functionName = aws.reqParams.FunctionName;
    var functionVersion = aws.params.FunctionVersion;
    var marker = aws.params.Marker;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = {
      Aliases: [ /*Sg*/{
        Name: '',
        AliasArn: '',
        FunctionVersion: '',
        Description: '',
      }, /* ...*/ ],
      NextMarker: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.InvokeAsync = awsCommon.as(
  '/2014-11-13/functions/:FunctionName/invoke-async/',
  function InvokeAsync(aws) {
    var functionName = aws.reqParams.FunctionName;
    var invokeArgs = aws.params.InvokeArgs /* Type blob */;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!invokeArgs) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter InvokeArgs'];
    }


    // TODO implement code

    var ret = {
      Status: 0,
    };
    return [202, ret];
  });
// -----------------------------------
module.exports.UpdateFunctionConfiguration = awsCommon.as(
  'PUT',
  '/2015-03-31/functions/:FunctionName/configuration',
  function UpdateFunctionConfiguration(aws) {
    var vpcConfig = aws.params.VpcConfig;
    var functionName = aws.reqParams.FunctionName;
    var memorySize = aws.params.MemorySize /* Type integer */;
    var description = aws.params.Description;
    var timeout = aws.params.Timeout /* Type integer */;
    var runtime = aws.params.Runtime;
    var role = aws.params.Role;
    var handler = aws.params.Handler;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = /*S15*/{
      VpcConfig: {
        SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
        VpcId: '',
        SubnetIds: /*S11*/[ '', /* ...*/ ],
      },
      CodeSize: 0 /*Long*/,
      Description: '',
      Timeout: 0,
      MemorySize: 0,
      Handler: '',
      LastModified: '',
      FunctionName: '',
      FunctionArn: '',
      CodeSha256: '',
      Version: '',
      Runtime: '',
      Role: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.RemovePermission = awsCommon.as(
  'DELETE',
  '/2015-03-31/functions/:FunctionName/policy/:StatementId',
  function RemovePermission(aws) {
    var statementId = aws.reqParams.StatementId;
    var functionName = aws.reqParams.FunctionName;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!statementId) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter StatementId'];
    }


    // TODO implement code

    var ret = {};
    return [204, ret];
  });
// -----------------------------------
module.exports.AddPermission = awsCommon.as(
  '/2015-03-31/functions/:FunctionName/policy',
  function AddPermission(aws) {
    var statementId = aws.params.StatementId;
    var functionName = aws.reqParams.FunctionName;
    var sourceArn = aws.params.SourceArn;
    var action = aws.params.Action;
    var eventSourceToken = aws.params.EventSourceToken;
    var sourceAccount = aws.params.SourceAccount;
    var principal = aws.params.Principal;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!statementId) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter StatementId'];
    }
    if (!action) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Action'];
    }
    if (!principal) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Principal'];
    }


    // TODO implement code

    var ret = {
      Statement: '',
    };
    return [201, ret];
  });
// -----------------------------------
module.exports.DeleteAlias = awsCommon.as(
  'DELETE',
  '/2015-03-31/functions/:FunctionName/aliases/:Name',
  function DeleteAlias(aws) {
    var name = aws.reqParams.Name;
    var functionName = aws.reqParams.FunctionName;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!name) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Name'];
    }


    // TODO implement code

    var ret = {};
    return [204, ret];
  });
// -----------------------------------
module.exports.GetFunctionConfiguration = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName/configuration',
  function GetFunctionConfiguration(aws) {
    var functionName = aws.reqParams.FunctionName;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = /*S15*/{
      VpcConfig: {
        SecurityGroupIds: /*S13*/[ '', /* ...*/ ],
        VpcId: '',
        SubnetIds: /*S11*/[ '', /* ...*/ ],
      },
      CodeSize: 0 /*Long*/,
      Description: '',
      Timeout: 0,
      MemorySize: 0,
      Handler: '',
      LastModified: '',
      FunctionName: '',
      FunctionArn: '',
      CodeSha256: '',
      Version: '',
      Runtime: '',
      Role: '',
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.Invoke = awsCommon.as(
  '/2015-03-31/functions/:FunctionName/invocations',
  function Invoke(aws) {
    var logType = aws.params.LogType;
    var functionName = aws.reqParams.FunctionName;
    var clientContext = aws.params.ClientContext;
    var invocationType = aws.params.InvocationType;
    var payload = aws.params.Payload /* Type blob */;
    var qualifier = aws.params.Qualifier;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }


    // TODO implement code

    var ret = {
      LogResult: '',
      Payload: null /*Blob*/,
      FunctionError: '',
      StatusCode: 0,
    };
    return [200, ret];
  });
// -----------------------------------
module.exports.GetAlias = awsCommon.as(
  'GET',
  '/2015-03-31/functions/:FunctionName/aliases/:Name',
  function GetAlias(aws) {
    var name = aws.reqParams.Name;
    var functionName = aws.reqParams.FunctionName;
    if (!functionName) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter FunctionName'];
    }
    if (!name) {
      return [400, 'Sender', 'MissingParameter', 'Did not specify parameter Name'];
    }


    // TODO implement code

    var ret = /*Sg*/{
      Name: '',
      AliasArn: '',
      FunctionVersion: '',
      Description: '',
    };
    return [200, ret];
  });
